{% extends "manage.html" %}

{% block title %} Grading papers for {{ data.user.get_full_name.title }} {% endblock title %}

{% block subtitle %}Grading papers for {{ data.user.get_full_name.title }}{% endblock %}
 
{% block css %}
	 <link rel="stylesheet" href="{{ URL_ROOT }}/static/yaksh/css/gradeuser.css" type="text/css" /> 
{% endblock %}

{% block script %}
<script src= "{{ URL_ROOT }}/static/yaksh/js/edit_question.js"></script>
{% endblock %}
{% block manage %}

<p> 
Name: {{ data.user.get_full_name.title }}
{% if data.profile %}
(roll number: {{ data.profile.roll_number }}) <br/>
Position: {{ data.profile.position }} <br/>
Department: {{ data.profile.department }} <br/>
Institute: {{ data.profile.institute }} <br/>
{% endif %}
</p>

{% if data.papers %}

{% for paper in data.papers %}

{% if forloop.counter == 2 and data.questionpaperid %}
<hr>
<u><h2> Previous attempts </h2></u>
{% endif %}
{{ paper.total_marks }}

<h2> Quiz: {{ paper.question_paper.quiz.description }} </h2>

<p>
Attempt Number: {{ paper.attempt_number }}<br/>
Questions correctly answered: {{ paper.get_answered_str }} <br/>
Total attempts at questions: {{ paper.answers.count }} <br/>
Marks obtained: {{ paper.get_total_marks }} <br/>
Start time: {{ paper.start_time }} <br/>
Paper Type: {{ paper.question_paper.quiz.description }}<br/>
</p>

{% if paper.answers.count %}

<h4> Report </h4><br>
<table class="zebra-striped">
    <th>Questions</th>
    <th>Marks Obtained</th>
    {% for question, answers in paper.get_question_answers.items %}
    {% with answers|last as answer %}
        <tr>
        <td>{{ question.id }}</td>
        <td>{{ answer.marks }}</td>
        </tr>
    {% endwith %}
    {% endfor %}
</table>

<h3> Answers </h3><br>
<form name=frm id="q{{ paper.quiz.id }}_form"
    {% if data.questionpaperid %}
    action="{{URL_ROOT}}/exam/manage/gradeuser/{{data.user.username}}/{{data.questionpaperid}}/"
    {% else %}
    action="{{URL_ROOT}}/exam/manage/gradeuser/{{data.user.username}}/"
    {% endif %}
    method="post">
{% csrf_token %}
{% for question, answers in paper.get_question_answers.items %}

<div class="for-question">
<p><strong> 
	Question: {{ question.id }}. {{ question.summary }} (Points: {{ question.points }})
</strong>
<strong><a href="" onClick="grade_data('myContent{{question.id}}'); return false;" style="cursor:pointer;" />Details</strong></p></a>
<div id="contentDiv">
     <div id="myContent{{question.id}}" style="padding:5px; display:none;">
        <p> Description : {{ question.description }} </p>
    	<p> Test : {{ question.test }} </p>
     </div>
</div> 
<div class="question-form">

{% if question.type == "mcq" %}
<br>
<p> Choices: 
{% for option in question.options.strip.splitlines %} {{option}}, {% endfor %}
</p>
<p>Student answer: {{ answers.0 }}</p>
{% else %}{# non-mcq questions #}
<pre>
{% for answer in answers %}################################################################################
{{ answer.answer.strip }}
# Autocheck: {{ answer.error }}
{% endfor %}</pre>
{% endif %} {# if question.type #}
{% with answers|last as answer %}
Marks: <input id="q{{ question.id }}" type="text" 
        name="q{{ question.id }}_marks" size="4"
        value="{{ answer.marks }}"><br><br>
{% endwith %}
</div>
</div>
{% endfor %} {# for question, answers ... #}


<h3>Teacher comments: </h3>
<textarea id="comments_{{paper.question_paper.id}}" rows="10" cols="80" 
    name="comments_{{ paper.question_paper.id }}">{{ paper.comments }}</textarea>
<br>
<br><button class="btn" type="submit" name="submit_{{paper.quiz.id}}">Save Marks</button>

</form>
{% endif %} {# if paper.answers.count #}

{% endfor %} {# for paper in data.papers #}

{% endif %} {# if data.papers #}

{% endblock%}
